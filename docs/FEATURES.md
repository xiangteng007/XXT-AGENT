# XXT-AGENT 功能規格文件

> **版本**: 1.0  
> **最後更新**: 2026-02-04

---

## 1. 系統核心功能

### 1.1 Triple Fusion 三元融合分析

XXT-AGENT 的核心是 **Triple Fusion Engine**，整合三大數據來源進行綜合分析：

| 數據來源 | 描述 | 對應服務 |
|----------|------|----------|
| **市場數據 (Market)** | 即時金融市場報價、趨勢 | `market-streamer` |
| **新聞分析 (News)** | 財經新聞、事件追蹤 | `news-collector` |
| **社群情緒 (Social)** | 社群媒體情緒、輿論風向 | `social-worker` |

```
Market Data ─────┐
                 │
News Data ───────┼──► Fusion Engine ──► AI Enrichment ──► Alerts
                 │                                         │
Social Data ─────┘                                         ▼
                                                    Trade Signals
```

---

## 2. 前端功能模組

### 2.1 Dashboard 儀表板

| 功能 | 路徑 | 描述 |
|------|------|------|
| **首頁概覽** | `/` | 系統狀態、關鍵指標摘要 |
| **即時指標** | 首頁 | 事件數、警報數、處理狀態 |

### 2.2 AI 分析模組

| 功能 | 路徑 | 描述 |
|------|------|------|
| **AI 儀表板** | `/ai` | Gemini AI 分析結果展示 |
| **智能洞察** | `/ai` | AI 生成的投資建議 |

### 2.3 市場數據模組 (`/market`)

| 功能 | 描述 |
|------|------|
| **即時報價** | 股票、期貨、基金即時價格 |
| **趨勢分析** | 價格走勢、技術指標 |
| **異動警報** | 價格異常波動通知 |
| **歷史數據** | 歷史價格查詢 |

### 2.4 新聞分析模組 (`/news`)

| 功能 | 描述 |
|------|------|
| **新聞列表** | 財經新聞聚合 |
| **情緒分析** | AI 驅動的新聞情緒標記 |
| **關鍵字追蹤** | 自定義關鍵字監控 |
| **新聞分類** | 按類別、來源分類 |
| **影響評估** | 新聞對市場的潛在影響 |

### 2.5 社群監控模組 (`/social`)

| 功能 | 描述 |
|------|------|
| **社群動態** | 社群媒體內容追蹤 |
| **情緒儀表板** | 整體社群情緒指標 |
| **熱門話題** | 趨勢話題識別 |
| **KOL 追蹤** | 意見領袖動態監控 |
| **病毒式傳播追蹤** | 快速傳播內容識別 |

### 2.6 投資組合模組 (`/portfolio`)

| 功能 | 描述 |
|------|------|
| **持倉管理** | 投資組合持倉追蹤 |
| **績效分析** | 收益率、風險指標 |

### 2.7 系統管理模組

| 功能 | 路徑 | 描述 |
|------|------|------|
| **事件管理** | `/events` | 系統事件查看 |
| **任務佇列** | `/jobs` | 背景任務監控 |
| **系統日誌** | `/logs` | 操作日誌查詢 |
| **資料映射** | `/mappings` | 資料欄位映射設定 |
| **規則管理** | `/rules` | 分析規則配置 |
| **系統指標** | `/metrics` | 效能指標監控 |
| **租戶管理** | `/tenants` | 多租戶配置 |
| **系統設定** | `/settings` | 全域設定 |

---

## 3. 後端功能服務

### 3.1 LINE 整合

| 功能 | 服務 | 描述 |
|------|------|------|
| **Webhook 接收** | `lineWebhook` | 接收 LINE 訊息事件 |
| **訊息處理** | `lineWorker` | 處理訊息並寫入 Notion |
| **簽章驗證** | `line.service` | LINE 訊息安全驗證 |

### 3.2 Notion 整合

| 功能 | 服務 | 描述 |
|------|------|------|
| **資料寫入** | `notion.service` | 寫入 Notion Database |
| **欄位映射** | `notion-mapper.service` | 動態欄位對應 |

### 3.3 AI 服務

| 功能 | 服務 | 描述 |
|------|------|------|
| **內容增強** | `gemini-enricher.service` | Gemini AI 內容分析 |
| **嚴重度評分** | Gemini | 事件嚴重度 0-100 評分 |
| **情緒分析** | Gemini | positive/negative/neutral |
| **實體識別** | Gemini | ticker/topic/location/person |
| **關鍵字提取** | Gemini | 自動關鍵字萃取 |

### 3.4 事件融合

| 功能 | 服務 | 描述 |
|------|------|------|
| **跨域關聯** | `fusion-engine.service` | 市場+新聞+社群事件關聯 |
| **時間窗口匹配** | Fusion | 10 分鐘滑動窗口 |
| **嚴重度增強** | Fusion | 多源事件嚴重度提升 |

### 3.5 警報系統

| 功能 | 服務 | 描述 |
|------|------|------|
| **警報觸發** | `alert-engine.service` | 條件式警報觸發 |
| **通知發送** | Alert | 多通道通知 (LINE/Telegram) |

### 3.6 規則引擎

| 功能 | 服務 | 描述 |
|------|------|------|
| **關鍵字匹配** | `rules.service` | 關鍵字/正則規則匹配 |
| **動態規則** | Rules | 可配置的分析規則 |

---

## 4. 微服務功能

### 4.1 AI Gateway

| 功能 | 描述 |
|------|------|
| **API 代理** | 安全代理 Gemini API 請求 |
| **速率限制** | 防止 API 濫用 |
| **密鑰管理** | Secret Manager 整合 |

### 4.2 Market Streamer

| 功能 | 描述 |
|------|------|
| **即時串流** | 市場數據即時獲取 |
| **報價標準化** | 統一報價格式 |
| **異動偵測** | 價格異常監控 |

### 4.3 News Collector

| 功能 | 描述 |
|------|------|
| **新聞爬蟲** | 多來源新聞收集 |
| **內容解析** | 新聞內容結構化 |
| **重複偵測** | 避免重複內容 |

### 4.4 Social Worker

| 功能 | 描述 |
|------|------|
| **社群監控** | 社群平台內容追蹤 |
| **情緒分析** | 社群情緒量化 |
| **趨勢識別** | 熱門話題追蹤 |

### 4.5 Telegram Bot

| 功能 | 描述 |
|------|------|
| **命令處理** | Telegram 機器人指令 |
| **警報推送** | 即時警報通知 |
| **查詢功能** | 市場/新聞即時查詢 |

### 4.6 Trade Planner

| 功能 | 描述 |
|------|------|
| **交易訊號** | AI 生成交易建議 |
| **風險評估** | 交易風險分析 |
| **計畫生成** | 自動交易計畫 |

---

## 5. 非功能性特性

### 5.1 效能

| 特性 | 描述 |
|------|------|
| **快速 ACK** | Webhook 5秒內回應 |
| **非同步處理** | 背景任務佇列 |
| **邊緣快取** | Vercel Edge 快取 |

### 5.2 可擴展性

| 特性 | 描述 |
|------|------|
| **多租戶** | 支援多團隊獨立配置 |
| **自動擴展** | Cloud Run 自動擴容 |
| **微服務架構** | 獨立擴展各服務 |

### 5.3 安全

| 特性 | 描述 |
|------|------|
| **LINE 簽章驗證** | Webhook 來源驗證 |
| **Secret Manager** | 密鑰安全儲存 |
| **RBAC** | 角色權限控制 |

### 5.4 可觀測性

| 特性 | 描述 |
|------|------|
| **結構化日誌** | Cloud Logging 整合 |
| **錯誤追蹤** | Sentry 即時監控 |
| **效能指標** | 自定義 Metrics |
